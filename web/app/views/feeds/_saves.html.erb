<%

  json_request = local_assigns.fetch(:json_request, false)

%>

<% if current_user and saved_events.present? %>
  <div id="saves" class="me-saves" data-controller="saves" data-target="saves.saves" data-observable="float-menu.section">
    <h2 data-target="saves.header" class="me-saves__title">
      Favoritos
      <%= link_to user_path current_user do %>
      <span class="me-see-all is-hoverable">
          Ver tudo
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8-8-8z"/></svg>
      </span>
      <% end %>
    </h2>
    <div class="me-icon__group">
      <div data-target="saves.scrollLeft" data-action="click->saves#scrollLeft"
           class="me-icon me-icon--scroll-left me-icon--off">
        <svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" focusable="false" class="style-scope iron-icon"
             style="pointer-events: none; display: block; width: 100%; height: 100%;">
          <g class="style-scope iron-icon">
            <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" class="style-scope iron-icon"></path>
          </g>
        </svg>
      </div>
      <div class="me-icon me-icon--scroll-right me-icon--off"
           data-action="click->saves#scrollRight"
           data-target="saves.scrollRight">
        <svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" focusable="false" class="style-scope iron-icon"
             style="pointer-events: none; display: block; width: 100%; height: 100%;">
          <g class="style-scope iron-icon">
            <path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z" class="style-scope iron-icon"></path>
          </g>
        </svg>
      </div>
    </div>
    <div class="me-saves__list mdc-layout-grid"
         data-target="saves.list">
      <div class="mdc-layout-grid__inner">
        <% saved_events.each do |event| %>
          <div class="mdc-layout-grid__cell">
            <div class="me-card mdc-card me-card--saves event-<%= event.id %>"
                 data-action="mouseover->saves-events#showEventDetails"
                 data-controller="saves-events"
                 data-saves-events-identifier="<%= event.id %>"
                 data-saves-flip-key="<%= "saves-#{dom_id event}" %>"
                 data-target="saves-events.event">
              <div class="me-card__remove"
                   data-action="click->saves-events#remove"
                   data-target="saves-events.remove">
                <svg viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet" focusable="false">
                  <path
                    d="m55.7 52.7c6.2 6.7 12.4 13.5 18.6 20.2 2.2 2.4-1.4 5.9-3.5 3.5-6.2-6.7-12.3-13.4-18.5-20.1-6.1 6.8-12.3 13.4-18.4 20.1-2.2 2.4-5.7-1.2-3.5-3.5 6.2-6.7 12.4-13.5 18.6-20.2-6.2-6.7-12.4-13.5-18.6-20.2-2.2-2.4 1.4-5.9 3.5-3.5 6.1 6.6 12.3 13.3 18.4 20 6.2-6.7 12.3-13.4 18.5-20.1 2.2-2.4 5.7 1.2 3.5 3.5-6.2 6.8-12.4 13.5-18.6 20.3z"></path>
                </svg>
              </div>
              <a href="<%= event.url %>"
                 title="<%= event.details_name %>">
                <div class="mdc-card__media mdc-card__media--16-9"
                     style="<%= get_image_style_attr event, preload: false %>">
                  <%= image_tag get_feed_image_url(event), loading: :lazy %>
                  <div class="me-card__overlay"
                       data-target="saves-events.overlay"
                       data-action="click->saves-events#animateOnClick"></div>
                </div>
                <div class="me-card__date <%= event.day_of_week['decorator'].parameterize %>" data-target="saves-events.date">
                  <span><i></i> <%= event.day_of_week['decorator'] %> <%= format_hour event.first_day_time %></span>
                  <span class="me-card__date-distance-in-words">
                    <%= event.first_day_time > DateTime.now ? "Daqui #{distance_of_time_in_words event.first_day_time, DateTime.now}" : "Iniciou há #{distance_of_time_in_words event.first_day_time, DateTime.now}" %>
                  </span>
                </div>
              </a>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>

<% else %>
  <div id="saves" class="me-saves me-saves--empty">
    <h2 class="me-saves__title">
      Salve eventos com ❤ para vê-los aqui
    </h2>
    <div class="me-saves__list mdc-layout-grid"
         data-target="saves.list">
      <div class="mdc-layout-grid__inner">
        <% 8.times do %>
          <div class="mdc-layout-grid__cell">
            <div class="me-card mdc-card me-card--saves">
              <div class="mdc-card__media mdc-card__media--16-9" style="">
                <div class="me-card__overlay"></div>
              </div>
              <div class="me-card__date">
                <span class="me-card__date-distance-in-words">Iniciou há 1 hora</span>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
<% end %>
