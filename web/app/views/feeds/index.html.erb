<section class="me-page me-page--feed-section is-animated">
  <%= render partial: 'components/swipable/swipable' unless current_user&.personas_assortment_finished? %>

  <% if current_user && current_user&.personas_assortment_finished? %>
    <div class="me-feed__section me-feed__section--without-margin">
      <div class="me-notification" data-controller="notification" data-notification-active="<%= current_user.notifications_topics_all_active %>">
        <div class="me-switch mdc-switch" data-target="notification.switch">
          <div class="mdc-switch__track"></div>
          <div class="mdc-switch__thumb-underlay">
            <div class="mdc-switch__thumb">
              <input data-target="notification.input" data-action="change->notification#change" type="checkbox" <%= 'checked' if current_user.notifications_topics_all_active %> id="another-basic-switch" class="mdc-switch__native-control" role="switch">
            </div>
          </div>
        </div>
        <label for="another-basic-switch" data-target="notification.label">Notificações
          <span>Receba até 1 notificação por dia para avisar sobre seus eventos agendados e novos eventos que podem te interessar.</span>
        </label>
      </div>
    </div>
  <% end %>

  <%= render partial: 'saves',
             locals:  {
                 identifier:   'salvos',
                 saved_events: @favorited_events
             } if current_user && current_user&.personas_assortment_finished? %>


  <section class="me-feed me-page__section">

    <% if current_user&.personas_assortment_finished? %>
      <% if @items.dig(:new_today, :detail, :total_events_in_collection).try { |counter| counter > 0 } %>
        <%= render partial: "components/collection/collection", locals: {
            data:  {
                identifier:  'new-today',
                collection:  @items[:new_today],
                title:       {
                    principal: "Adicionados recentemente",
                    # secondary: "Foram adicionados #{@items.dig(:new_today, :detail, :total_events_in_collection)} eventos nas últimas 24 horas que podem te interessar",
                    tertiary: "Com base no seu perfil"
                },
                type:        :large,
                filters:     {
                    categories: false,
                    kinds:      false,
                    ocurrences: true
                },
                continue_to: "/#{current_user.slug}/novos",
                origin:      :feed
            },
            props: {
                disposition: :horizontal
            }
        } %>
      <% end %>


      <% if current_user && @items.dig(:user_suggestions, :detail, :total_events_in_collection).try { |counter| counter > 0 } %>
        <%= render partial: "components/collection/collection", locals: {
            data:  {
                identifier:  'user-suggestions',
                collection:  @items[:user_suggestions],
                title:       {
                    principal: "Escolhidos a dedo para #{current_user.first_name}",
                    # secondary: "Explore os eventos com alta recomendação para seu gosto pessoal",
                    tertiary: "Com base nos eventos salvos"
                },
                type:        :large,
                filters:     {
                    categories: false,
                    kinds:      false,
                    ocurrences: false
                },
                detail:      @items[:user_suggestions][:detail],
                origin:      :feed,
                continue_to: "/#{current_user.slug}/sugestoes"
            },
            props: {
                disposition: :horizontal
            }
        } %>
      <% end %>


      <% if current_user && @items.dig(:follow, :detail, :total_events_in_collection).try { |counter| counter > 0 } %>
        <% follow_custom_title = capture do %>
          <div class="me-chip-set__wrapper">
            <div class="me-chip-set mdc-chip-set">
              <% current_user.following_topics.each do |topic| %>
                <a href="<%= link_to_topic topic %>" class="me-chip mdc-chip">
                <span class="mdc-chip__text">
                  <%= topic.details_name %>
                </span>
                </a>
              <% end %>
            </div>
          </div>
        <% end %>
        <%= render partial: "components/collection/collection", locals: {
            data:  {
                identifier:  'follow',
                collection:  @items[:follow],
                title:       {
                    principal: "Tópicos que você segue",
                    custom:    follow_custom_title
                },
                type:        :large,
                filters:     {
                    categories: false,
                    kinds:      false,
                    ocurrences: false
                },
                detail:      @items[:follow][:detail],
                origin:      :feed,
                continue_to: "/#{current_user.slug}/seguindo"

            },
            props: {
                disposition: :horizontal
            }
        } %>
      <% end %>



      <% if @items.dig(:week, :detail, :total_events_in_collection).try { |counter| counter > 0 } %>
        <%= render partial: "components/collection/collection", locals: {
            data:  {
                identifier:  'this-week',
                collection:  @items[:week],
                title:       {
                    principal: "Acontecendo esta semana",
                    # secondary: "Hoje (#{I18n.l(Date.today, format: :short)}) até #{I18n.l(Date.today + 8, format: :week)} (#{I18n.l(Date.today + 7, format: :short)})",
                    tertiary: "Com base no seu perfil"
                },
                type:        :large,
                filters:     {
                    categories: false,
                    kinds:      false,
                    ocurrences: true
                },
                continue_to: '/porto-alegre/eventos/semana',
                origin:      :feed
            },
            props: {
                disposition:     :vertical,
                infinite_scroll: true
            }
        } %>
      <% end %>


      <% if @items.dig(:explorer, :detail, :total_events_in_collection).try { |counter| counter > 0 } %>
        <%= render partial: "components/collection/collection", locals: {
            data: {
                identifier: 'explorer',
                collection: @items[:explorer],
                title:      {
                    principal: "Explorar todos os eventos",
                    secondary: "Use os filtros abaixo e seja feliz :)"
                },
                type:       :large,
                filters:    {
                    categories: true,
                    kinds:      false,
                    ocurrences: true
                },
                detail:     @items[:explorer][:detail],
                origin:     :feed
            }
        } %>
      <% end %>
    <% end %>
  </section>
</section>
