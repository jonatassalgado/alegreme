<%

	props = {
		visible: {
			logo:         (!mobile_device? && ['search'].include?(controller_name)) || !['search'].include?(controller_name),
			back_button:  content_for?(:back_button) && request.headers['Referer']&.start_with?(root_url),
			search:       (['feeds', 'events', 'organizers', 'places', 'movies', 'dashboard'].include?(controller_name) && !mobile_device?) ||
											['search', 'pages'].include?(controller_name),
			share_button: content_for?(:share_button_url) && action_name == 'show' && mobile_device?,
			user_menu:    ['feeds', 'movies'].include?(controller_name) && action_name != 'show' && current_user,
			sign_up:      !current_user
		}
	}

%>

<header class="<%= class_names('md:px-0 px-5 justify-between h-14 md:h-16 max-w-screen-lg md:grid md:grid-cols-12 mx-auto my-auto select-none ',
															 { 'flex h-14':      !current_page?('/busca'),
																 'h-content py-2': current_page?('/busca') }) %>"
				id="top-bar">
	<div class="<%= class_names 'flex md:relative md:col-span-3 h-full w-full',
															'space-x-4': content_for?(:top_app_bar_title) && request.headers['Referer']&.start_with?(root_url) %>">
		<% if mobile_device? %>
			<div class="my-auto text-gray-800 md:hidden">
				<% if props[:visible][:back_button] %>
					<a onclick="TurboModule.backHistory()"
						 class="flex h-8 inline-block items-center justify-center relative select-none w-8"
						 tabindex="0"
						 role="button"
						 aria-label="Voltar">
						<svg class="h-4 fill-current stroke-current md:w-auto" viewBox="0 0 21 18" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M10.5 17L1.5 9M1.5 9L10.5 1M1.5 9H20" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
						</svg>
					</a>
				<% end %>
			</div>
		<% end %>
		<div class="<%= class_names 'relative h-full inline-flex items-center flex-auto md:pr-0',
																'hidden': !props[:visible][:logo] %>">
			<% if mobile_device? && request.headers['Referer']&.start_with?(root_url) && content_for?(:top_app_bar_title) %>
				<turbo-frame id="top-app-bar--title" class="font-semibold text-gray-800">
					<%= content_for(:top_app_bar_title) %>
				</turbo-frame>
			<% elsif props[:visible][:logo] %>
				<a class="inline-block relative transition-transform md:transform md:hover:scale-105 md:ml-0"
					 aria-label="PÃ¡gina inicial"
					 href="<%= root_path %>">
					<svg class="h-5 md:h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 547.21 65.71">
						<g data-name="Layer 2">
							<g fill="#4036ed" data-name="Layer 1">
								<path d="M23.38 0 0 64.14l16.33.06 3.87-11.33 23.89.13 3.8 11.35 16.51.06L41.45.06Zm1 40.8 7.93-23.48 7.85 23.54ZM87.24.21h-15.6l-.2 59.66A4.56 4.56 0 0 0 76 64.4l31.48.1V52.43l-20.43-.07ZM131.6 52.05v-14h59.68V26h-59.64V12.93c9.1 0 50.53 0 62 .07V.31H116.1L116 64.6h77.76V52.05c-11.83-.05-53.3.03-62.16 0ZM228.84 40.54l19.79.07c-2.39 7.22-7.79 11.32-15.54 11.29-11.22 0-18-7-17.91-18.91 0-11.16 6.72-18.27 16.76-18.23 5.84 0 10.21 2.32 12.56 6.62l17.24.06C258.41 8.26 247.31.35 232 .3c-19.16-.06-32.61 13.43-32.68 32.64s13.39 32.71 32.55 32.77c16.87.06 27.58-11 30.9-22l.05-14.54-33.94-.17ZM321.22 20.68c0-11.16-7.78-20.24-23.47-20.29L271.57.3l-.21 64.22h15.6l.04-24.19h3.74L304 64.63l17.61.06-14.68-25.48c9.86-2.9 14.26-10.48 14.29-18.53Zm-24.48 8.61h-9.67l.06-15.92h9.67c5.83 0 8.56 3.14 8.54 7.9-.01 5.03-2.76 8.04-8.6 8.02ZM330.83 64.52l39.22.13.05-12.53-23.63-.08.05-14.09 20.89.07.04-12.07-20.89-.07.04-13 23.63.08.04-12.53L331.05.3l-.22 64.22zM416.64 44.88 398.82.36 380.39.3l-.21 64.22 15.6.05.13-38.6 14.28 38.65 12.59.04 14.45-38.46-.13 38.51 15.59.05.22-64.22-18.33-.06-17.94 44.4zM503.31 12.96l.05-12.53L464.13.3l-.21 64.22 39.22.13.04-12.53-23.62-.08.04-14.09 20.89.07.04-12.07-20.89-.07.05-13 23.62.08zM547.21 1.39v33.16a1.2 1.2 0 0 1-1.81 1l-13.66-7.81a.91.91 0 0 0-1.11 0L517 35.59a1.2 1.2 0 0 1-1.81-1V1.39A1.39 1.39 0 0 1 516.55 0h29.27a1.39 1.39 0 0 1 1.39 1.39Z"/>
							</g>
						</g>
					</svg>
				</a>
				<% if controller_name != 'feeds' %>
					<h1 class="absolute bottom-1 font-light left-8 text-left text-xxs w-full">
						Eventos e cinema em Porto Alegre
					</h1>
				<% end %>
			<% end %>
		</div>
		<% if !current_user && controller_name == 'feeds' %>
			<%= link_to search_index_path, class: 'md:hidden my-auto', 'aria-label': 'Buscar' do %>
				<svg class="fill-current h-auto text-gray-800 w-7" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
					<path fill="none" d="M0 0h24v24H0V0z"/>
					<path d="M15.5 14h-.79l-.28-.27c1.2-1.4 1.82-3.31 1.48-5.34-.47-2.78-2.79-5-5.59-5.34-4.23-.52-7.79 3.04-7.27 7.27.34 2.8 2.56 5.12 5.34 5.59 2.03.34 3.94-.28 5.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
				</svg>
			<% end %>
			<%= link_to new_user_registration_path, class: 'bg-gray-100 flex font-semibold md:hidden ml-2 my-auto px-2 py-1 rounded-full text-gray-800' do %>
				<svg class="float-right mr-1 w-6 text-gray-800 stroke-current" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
				</svg>
				Entrar
			<% end %>
		<% end %>
	</div>
	<% if props[:visible][:search] %>
		<div class="<%= class_names('col-span-12 md:col-span-6',
																{ 'hidden md:block': controller_name != 'search' }) %>">
			<form
				class="flex items-center h-full rounded"
				data-search-target="search"
				data-reflex-permanent
				data-turbo-permanent
				action="/busca"
				method="get"
				name="search"
				style="width: 100%">
				<input autocomplete="false"
							 name="q"
							 class="bg-gray-100 focus:bg-white focus:border-transparent focus:outline-none focus:placeholder-brand-600 focus:ring focus:ring-brand-500 font-light h-11 mx-auto placeholder-gray-500 px-4 py-1 rounded-full text-xs w-full"
							 id="text-field-shape-one"
							 placeholder="Busque por rock, feira de rua, samba, standup..."
							 type="text"
							 data-search-target="input">
				<input class="px-4 my-1 ml-3 h-10 font-light font-medium text-white rounded cursor-pointer bg-brand-600 md:hidden"
							 type="submit" value="Buscar"
							 data-search-target="submit"
							 data-action="click->search#searching"/>
			</form>
		</div>
	<% else %>
		<div class="hidden md:col-span-3 md:inline-block"></div>
	<% end %>
	<div class="md:col-span-3 flex-shrink-0">
		<div class="flex h-full items-center justify-end">
			<% if current_user && controller_name != 'search' %>
				<%= link_to search_index_path, class: 'md:hidden mr-3', 'aria-label': 'Buscar' do %>
					<svg class="w-6 h-auto fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
						<path fill="none" d="M0 0h24v24H0V0z"/>
						<path d="M15.5 14h-.79l-.28-.27c1.2-1.4 1.82-3.31 1.48-5.34-.47-2.78-2.79-5-5.59-5.34-4.23-.52-7.79 3.04-7.27 7.27.34 2.8 2.56 5.12 5.34 5.59 2.03.34 3.94-.28 5.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
					</svg>
				<% end %>
				<%= link_to profile_path(current_user), class: 'c-chip border-0 md:border p-0 md:p-2 bg-gray-200 md:bg-white' do %>
					<% if current_user&.picture %>
						<%= image_tag(current_user.picture, { class: "w-7 h-7 border rounded-full", alt: current_user&.name, onerror: "this.style.opacity='0'" }) rescue nil %>
					<% else %>
						<div class="mr-2 w-7 h-7 bg-gray-100 rounded-full"></div>
					<% end %>
					<div class="font-semibold text-gray-800 pl-2 text-sm md:text-base hidden md:inline-block">
						<%= truncate(current_user&.name, length: 15) %>
					</div>
				<% end %>
			<% else %>
				<% if controller_name == 'events' && action_name == 'show' %>
					<a href="<%= search_index_path %>" class="md:hidden" aria-label="Buscar">
						<svg class="w-6 h-auto fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
							<path fill="none" d="M0 0h24v24H0V0z"/>
							<path d="M15.5 14h-.79l-.28-.27c1.2-1.4 1.82-3.31 1.48-5.34-.47-2.78-2.79-5-5.59-5.34-4.23-.52-7.79 3.04-7.27 7.27.34 2.8 2.56 5.12 5.34 5.59 2.03.34 3.94-.28 5.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
						</svg>
					</a>
				<% end %>
				<%= link_to 'Entrar', new_user_session_path, class: 'hidden md:inline-block hover:text-brand-600 px-3 text-gray-800 text-sm' %>
				<% if controller_name == 'feeds' && action_name == 'index' %>
					<%= link_to 'Criar conta',
											new_user_registration_path,
											data:     {
												'gtm-action':   'click',
												'gtm-category': 'Funil',
												'gtm-label':    'Criar meu perfil'
											}, class: 'hidden md:inline-block hover:text-brand-600 px-3 text-gray-800 text-sm' %>
				<% else %>
					<%= link_to 'Criar conta',
											new_user_registration_path,
											data:     {
												'gtm-action':   'click',
												'gtm-category': 'Funil',
												'gtm-label':    'Criar meu perfil'
											}, class: 'hidden md:inline-block bg-brand-600 border border-transparent focus:outline-none focus:ring-2 focus:ring-brand-500 focus:ring-offset-2 font-medium hover:bg-brand-500 inline-flex items-center px-4 py-2 rounded-md shadow-sm text-sm text-white' %>
				<% end %>
			<% end %>
		</div>
	</div>
</header>
