<% return if Rails.env.production? && current_user.try(:admin?) %>

<!-- Google Analytics -->
<script>
    window.dataLayer = window.dataLayer || [];

    if (window.location.pathname === "/") {
        window.dataLayer.push({
                                  event: "pageview",
                                  page:  {
                                      path:  window.location.pathname,
                                      title: document.title
                                  }
                              });
    } else {
        document.addEventListener("turbolinks:load", function (event) {
            <% if current_user %>
            window.dataLayer.push({
                                      userId: <%= current_user.try(:id) %>
                                  })
            <% end %>
            window.dataLayer.push({
                                      event: "pageview",
                                      page:  {
                                          path:  window.location.pathname,
                                          title: document.title
                                      }
                                  });

        });
    }

    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({
                      "gtm.start":
                             new Date().getTime(),
                      event: "gtm.js"
                  });
        var f                          = d.getElementsByTagName(s)[0],
            j = d.createElement(s), dl = l != "dataLayer" ? "&l=" + l : "";
        j.async                        = true;
        j.src                          =
            "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, "script", "dataLayer", "GTM-WH7RVCR");
</script>
<!-- End Google Analytics -->
