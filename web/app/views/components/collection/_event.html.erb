<%

  identifier = local_assigns.fetch(:identifier, 'similar')
  event_type = local_assigns.fetch(:type, 'default')
  is_similar_open = params[:similar].to_i == event.id ? true : false
  display_similar = local_assigns.fetch(:display_similar, true)
  display_place = local_assigns.fetch(:display_place, true)
  json_request = local_assigns.fetch(:json_request, false)

%>

<div class="mdc-layout-grid__cell"
     id="<%= "cell-#{identifier}-#{rand(1_000)}-#{dom_id event}" %>"
     style="order: <%= event_counter + 1 %>;">
  <div class="me-card me-card--feed mdc-card mdc-card--outlined event-<%= event.id %>"
       data-action="mouseover->event#showEventDetails"
       data-collection-<%= identifier %>-flip-key="<%= "#{identifier}-#{event_type}-#{dom_id event}" %>"
       data-controller="event"
       data-event-favorited="<%= current_user.taste_events_saved? event.id if current_user %>"
       data-event-identifier="<%= event.id %>"
       data-event-similar-open="<%= is_similar_open %>"
       data-event-similar-loading="false"
       data-event-dominant-color="<%= get_image_dominant_color event %>"
       data-target="event.event"
       id="<%= dom_id event %>">
    <div data-fixed="true" class="mdc-card__media mdc-card__media--16-9 <%= 'lazy-bgimage' unless json_request  %>" <%= "data-src=#{get_original_image_url(event)}" unless json_request %> style="<%= get_image_style_attr event, preload: json_request %>">
      <% if current_user %>
        <div class="me-card__like-button" data-action="click->event#like">
          <div data-target="event.like">
            <button data-target="event.likeButton"
                    id="add-to-favorites"
                    class="me-icon-button mdc-icon-button <%= 'mdc-icon-button--on' if current_user.taste_events_saved?(event.id) %>"
                    aria-label="Add to favorites"
                    aria-hidden="true"
                    aria-pressed="false"
                    style="<%= 'display: inline' if current_user.taste_events_saved?(event.id) %>">
              <i class="material-icons mdc-icon-button__icon mdc-icon-button__icon--on">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 62 62">
                  <defs/>
                  <path fill-rule="evenodd" d="M61.9999 31c0 17.1208-13.8791 30.9999-30.9999 30.9999C13.8792 61.9999 0 48.1208 0 31 0 13.8792 13.8792 0 31 0s30.9999 13.8792 30.9999 31zm-13.6836-7.8711c0 2.9426-2.3932 5.3281-5.3454 5.3281-2.9522 0-5.3454-2.3855-5.3454-5.3281s2.3932-5.3281 5.3454-5.3281c2.9522 0 5.3454 2.3855 5.3454 5.3281zm-23.8208 0c0 2.9426-2.3933 5.3281-5.3455 5.3281-2.9522 0-5.3454-2.3855-5.3454-5.3281s2.3932-5.3281 5.3454-5.3281c2.9522 0 5.3455 2.3855 5.3455 5.3281zm23.0007 16.3239c.0243-.0454 1.6832-3.2152 1.699-3.2458L13.5 36.2266l1.396 3.0497.0034.0067.0079.0156.0205.0401c.0158.0305.0359.0687.0602.1141.0488.0907.1149.2103.1988.3546.1676.2882.4077.6775.7238 1.134.6292.9088 1.5775 2.1099 2.878 3.3139 2.6185 2.4243 6.7324 4.9088 12.4535 4.9088s9.835-2.4845 12.4535-4.9088c1.3005-1.204 2.2488-2.4051 2.878-3.3139.3161-.4565.5562-.8458.7238-1.134.0839-.1443.15-.2639.1988-.3546z" clip-rule="evenodd"/>
                </svg>
              </i>
              <i class="material-icons-sharp mdc-icon-button__icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 62 62">
                  <defs/>
                  <path fill-rule="evenodd" d="M61.9999 31c0 17.1208-13.8791 30.9999-30.9999 30.9999C13.8792 61.9999 0 48.1208 0 31 0 13.8792 13.8792 0 31 0s30.9999 13.8792 30.9999 31zm-13.6836-7.8711c0 2.9426-2.3932 5.3281-5.3454 5.3281-2.9522 0-5.3454-2.3855-5.3454-5.3281s2.3932-5.3281 5.3454-5.3281c2.9522 0 5.3454 2.3855 5.3454 5.3281zm-23.8208 0c0 2.9426-2.3933 5.3281-5.3455 5.3281-2.9522 0-5.3454-2.3855-5.3454-5.3281s2.3932-5.3281 5.3454-5.3281c2.9522 0 5.3455 2.3855 5.3455 5.3281zm-6.5704 14.621c-3.032 1.5205-3.0313 1.5219-3.0306 1.5234l.0015.003.0034.0067.0079.0156.0205.0401c.0158.0305.0359.0687.0602.1141.0488.0907.1149.2103.1988.3546.1676.2882.4077.6775.7238 1.134.6292.9088 1.5775 2.1099 2.878 3.3139 2.6185 2.4243 6.7324 4.9088 12.4535 4.9088s9.835-2.4845 12.4535-4.9088c1.3005-1.204 2.2488-2.4051 2.878-3.3139.3161-.4565.5562-.8458.7238-1.134.0839-.1443.15-.2639.1988-.3546a8.407 8.407 0 00.0602-.1141l.0206-.0401.0078-.0156.0034-.0067.0015-.003c.0007-.0015.0015-.0029-3.0306-1.5234-3.032-1.5206-3.0313-1.5219-3.0306-1.5233l.0012-.0025.0023-.0045.0035-.0069.0028-.0056a5.1948 5.1948 0 01-.0971.1739c-.0873.1501-.2322.3869-.4363.6817-.4112.5939-1.0443 1.3964-1.9079 2.1959-1.7095 1.5827-4.2541 3.1054-7.8549 3.1054-3.6008 0-6.1454-1.5227-7.8549-3.1054-.8636-.7995-1.4967-1.602-1.9079-2.1959a10.3959 10.3959 0 01-.4362-.6817 5.039 5.039 0 01-.0867-.1541c-.0072-.0133-.0107-.0201-.0106-.0199l.0029.0057.0035.0069.0023.0045.0012.0025c.0007.0014.0014.0027-3.0306 1.5233z" clip-rule="evenodd"/>
                </svg>
              </i>
            </button>
          </div>
        </div>
      <% end %>
      <a href="<%= event.url %>">
        <div class="me-card__overlay mdc-ripple-surface"
             data-target="event.overlay"></div>
      </a>
      <% if false %>
        <div class="me-card__like-button"
             data-action="click->event#like">
          <div data-target="event.like">
            <button data-target="event.likeButton"
                    id="add-to-favorites"
                    class="me-icon-button mdc-icon-button <%= 'mdc-icon-button--on' if current_user.taste_events_saved?(event.id) %>"
                    aria-label="Add to favorites"
                    aria-hidden="true"
                    aria-pressed="false">
              <i class="material-icons mdc-icon-button__icon mdc-icon-button__icon--on">star</i>
              <i class="material-icons mdc-icon-button__icon">star</i>
            </button>
          </div>
        </div>
      <% end %>
    </div>
    <div class="me-card__primary-section">
      <span class="me-card__category"
          data-target="event.category">
          <%= link_to event.categories_primary_name.try(:capitalize), category_events_path(event.categories_primary_name) %>
      </span>
      <span aria-hidden="true"> Â· </span>
      <span class="me-card__date <%= 'is-highlight' if event.day_of_week['decorator'] == 'hoje' %>"
            data-target="event.date">
        <%= event.day_of_week['decorator'] %> <%= format_hour event.first_day_time %>
      </span>
      <span class="me-card__price <%='is-highlight' if (event.details_prices.present? && event.details_prices.min.to_i <= 20) %>">
          <%= " Â· R$#{event.details_prices.min}" if event.details_prices.present? %>
      </span>
    </div>
    <div class="me-card__secondary-section">
      <div class="me-card__title"
           data-target="event.name"
           title="<%= event.details_name %>">
        <%= link_to limit_name_size(event.details_name), event_path(event) %>
      </div>
      <%= event.ml_data['personas']['primary'].to_json if Rails.env == 'development' && params[:debug]  %>
      <%= event.ml_data['categories']['primary'].to_json if Rails.env == 'development' && params[:debug] %>
    </div>
    <div class="me-card__tertiary-section">
      <% if display_place %>
        <div class="me-card__place"
             data-target="event.place"
             title="<%= event.place_details_name %>">
          <%= link_to limit_place_name_size(event.place_details_name), place_path(event.place) %>
        </div>
      <% end %>
    </div>
    <% if display_similar && event.similar_data.empty? == false %>
      <div class="me-card__similar"
           data-action="click->event#showSimilar"
           data-target="event.similar"
           title="Mostrar eventos parecidos">
        <button class="mdc-button mdc-button--dense">
          <span class="mdc-button__label">
            Ver similares
          </span>
          <i class="me-card__expand-more material-icons">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24">
              <path opacity=".87" fill="none" d="M24 24H0V0h24v24z"/>
              <path d="M15.88 9.29L12 13.17 8.12 9.29c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41l4.59 4.59c.39.39 1.02.39 1.41 0l4.59-4.59c.39-.39.39-1.02 0-1.41-.39-.38-1.03-.39-1.42 0z"/>
            </svg>
          </i>
          <i class="me-card__loading material-icons">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M17.65 6.35c-1.63-1.63-3.94-2.57-6.48-2.31-3.67.37-6.69 3.35-7.1 7.02C3.52 15.91 7.27 20 12 20c3.19 0 5.93-1.87 7.21-4.56.32-.67-.16-1.44-.9-1.44-.37 0-.72.2-.88.53-1.13 2.43-3.84 3.97-6.8 3.31-2.22-.49-4.01-2.3-4.48-4.52C5.31 9.44 8.26 6 12 6c1.66 0 3.14.69 4.22 1.78l-1.51 1.51c-.63.63-.19 1.71.7 1.71H19c.55 0 1-.45 1-1V6.41c0-.89-1.08-1.34-1.71-.71l-.64.65z"/></svg>
          </i>
        </button>
      </div>
    <% end %>
  </div>
</div>
