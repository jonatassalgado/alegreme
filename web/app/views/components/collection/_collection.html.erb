<%

  raise ArgumentError unless data

  data = {
      collection:                  {},
      user:                        current_user,
      identifier:                  nil,
      total_events_in_collection:  0,
      actual_events_in_collection: 0,
      followable:                  nil,
      title:                       {
          principal: nil,
          secondary: nil
      },
      continue_to:                 nil,
      json_request:                false,
      origin:                      nil,
      filters:                     {
          categories: true,
          kinds:      true,
          ocurrences: true
      },
      categories:                  [],
      ocurrences:                  [],
      kinds:                       [],
      insert_after:                nil
  }.deep_merge!(data)

  props = {
      infinite_scroll: false,
      disposition:     :vertical
  }.deep_merge!(props || {})

%>

<section class="me-collection"
         data-controller="section"
         data-target="section.section"
         data-section-total-events-in-collection="<%= data[:collection][:detail][:total_events_in_collection] %>"
         data-section-actual-events-in-collection="<%= data[:collection][:detail][:actual_events_in_collection] %>"
         data-section-load-more-loading="false"
         data-section-infinite-scroll="<%= props[:infinite_scroll] %>"
         data-section-disposition="<%= props[:disposition] %>"
         data-section-identifier="<%= data[:identifier] %>"
         data-section-init-filters-applyed="<%= data[:collection][:detail][:init_filters_applyed].to_json %>"
         data-section-origin="<%= data[:origin] %>"
         data-section-continue-to-path="<%= data[:continue_to] %>"
         data-section-title="<%= data[:title].to_json %>"
         data-observable="float-menu.section"
         id="<%= data[:identifier] %>">
  <div class="me-collection__head">
    <% if data[:title][:tertiary] %>
      <div class="me-collection__title-tertiary">
        <%= data[:title][:tertiary] %>
      </div>
    <% end %>
    <h2>
      <%= data[:title][:principal] %>
      <%# if data[:collection][:detail][:actual_events_in_collection] < data[:collection][:detail][:total_events_in_collection] %>
      <span class="me-see-all is-hoverable"
            data-fixed="true"
            onclick="Turbolinks.visit('<%= data[:continue_to] %>')">
          Ver tudo
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8-8-8z"/></svg>
        </span>
      <%# end %>
      <%= render partial: 'components/follow/follow_button', locals: {
          identifier: data[:identifier],
          user:       data[:user],
          followable: data[:followable]
      } if data[:followable] %>
    </h2>
    <% if data[:title][:secondary] %>
      <div class="me-collection__title-secondary">
        <%= data[:title][:secondary] %>
      </div>
    <% end %>
    <% if data[:title][:custom] %>
      <div class="me-collection__title-custom"
           data-fixed="true">
        <%= data[:title][:custom] %>
      </div>
    <% end %>
    <% unless data[:title][:custom] %>
    <div class="me-filter"
         data-target="section.filter">
      <% if data[:filters][:categories] && !data[:collection][:categories].blank? %>
        <%= render(partial: 'feeds/filter',
                   locals:  {
                       data: {
                           initial_filters:              data[:collection][:categories],
                           params_filters:               data[:categories],
                           filters_that_exist_in_events: data[:collection][:categories],
                           icon_type:                    'filter_list',
                           type:                         'categories'
                       }
                   },
                   cached:  true) %>
      <% end %>
      <% if (data[:filters][:kinds] && data[:categories] && !data[:collection][:kinds].blank?) || (data[:filters][:kinds] && !params[:kinds].blank?) %>
        <%= render(partial: 'feeds/filter',
                   locals:  {
                       data: {
                           initial_filters:              data[:collection][:kinds],
                           params_filters:               data[:kinds],
                           filters_that_exist_in_events: data[:collection][:kinds],
                           icon_type:                    'filter_list',
                           type:                         'kinds'
                       }
                   },
                   cached:  true) %>
      <% end %>
      <!-- TODO: remover duplicado-->
      <% if data[:filters][:ocurrences] && !data[:collection][:ocurrences].blank? %>
        <%= data[:title][:ocurrences] %>
        <%= render(partial: 'feeds/filter',
                   locals:  {
                       data: {
                           initial_filters:              data[:collection][:ocurrences],
                           params_filters:               data[:ocurrences],
                           filters_that_exist_in_events: data[:collection][:ocurrences],
                           icon_type:                    '',
                           type:                         'ocurrences'
                       }
                   },
                   cached:  true) %>
      <% end %>
    </div>
    <% end %>
  </div>
  <div class="mdc-layout-grid">
    <div class="mdc-layout-grid__inner"
         data-section-turbolinks-persist-scroll="0"
         data-target="section.scrollContainer">
      <% unless data[:collection].empty? %>
        <%= render(partial:    'components/collection/event',
                   collection: data[:collection][:events],
                   as:         :event,
                   locals:     {
                       identifier:   data[:identifier],
                       json_request: data[:json_request]
                   },
                   cached:     false) %>

        <%= render(partial: 'components/collection/similar',
                   locals:  {
                       data: {
                           similar:      data[:similar],
                           events:       data[:collection][:events],
                           identifier:   data[:identifier],
                           json_request: data[:json_request],
                           insert_after: data[:insert_after]
                       }
                   },
                   cached:  true) if !mobile_device? || props[:disposition] == 'vertical' %>

        <% if data[:collection][:detail][:actual_events_in_collection] < data[:collection][:detail][:total_events_in_collection] %>
          <div data-action="click->section#loadMore"
               data-target="section.loadMoreButton"
               data-continue-to-path="<%= data[:continue_to] %>"
               class="me-collection__load-more me-collection__load-more--horizontal">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
              <path fill="none" d="M0 0h24v24H0V0z"/>
              <path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8-8-8z"/>
            </svg>
          </div>
          <div class="me-collection__load-more me-collection__load-more--horizontal is-loading">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
              <path fill="none" d="M0 0h24v24H0V0z"/>
              <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
            </svg>
          </div>
        <% end %>
      <% end %>
    </div>
    <%= render(partial: 'components/collection/similar',
               locals:  {
                   data: {
                       similar:      data[:similar],
                       events:       data[:collection][:events],
                       identifier:   data[:identifier],
                       json_request: data[:json_request],
                       insert_after: data[:insert_after]
                   }
               },
               cached:  true) if mobile_device? && props[:disposition] == 'horizontal' %>
    <% if data[:collection][:detail][:actual_events_in_collection] < data[:collection][:detail][:total_events_in_collection] %>
      <div class="me-collection__load-more me-collection__load-more--vertical is-hoverable"
           data-action="click->section#loadMore"
           data-target="section.loadMoreButton">
        <%# if data[:origin] == :feed %>
        <!--          <button class="me-button me-button--transparent me-button--with-icon-in-right mdc-button"-->
        <!--                  data-action="click->section#loadMore"-->
        <!--                  data-target="section.loadMoreButton">-->
        <!--            <span class="me-button__label">Mostrar mais</span>-->
        <!--            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">-->
        <!--              <path fill="none" d="M0 0h24v24H0V0z"/>-->
        <!--              <path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8-8-8z"/>-->
        <!--            </svg>-->
        <!--          </button>-->
        <%# else %>
        Mostrar mais
        <%# end %>
      </div>
    <% end %>
    <% unless data[:collection][:events] %>
      <div class="me-card me-card--notice mdc-card mdc-card--outlined">
        <div class="me-card__primary-section">
          <i class="material-icons">
            info
          </i>
          Nenhum evento com as caracter√≠sticas selecionadas
        </div>
        <div class="me-card__secondary-section">
          Tente remover alguns filtros ou volte para a listagem completa sem filtros.
        </div>
        <!--        <div class="me-card__primary-action">-->
        <!--          Voltar para listagem completa-->
        <!--        </div>-->
      </div>
    <% end %>
  </div>
</section>
