<%= notice %>

<% content_for :meta_title, "Evento #{@event.details_name.gsub(/[^[$][-]\p{L}\p{M}*+ ]|[+]/i, '')} em Porto Alegre | Alegreme.com" %>
<% content_for :meta_description, strip_tags(limit_description_size(@event.details_description, 160)) %>
<% content_for :meta_image, @event.image[:original].try { |image| image.url(public: true) } %>
<% content_for :canonical_url, event_url(@event, format: :html) %>
<% content_for :amp_url, event_url(@event, format: :amp) %>

<% content_for :back_button, true %>
<% content_for :top_app_bar_title, truncate(@event.details_name, length: 30) %>

<%= content_for :preload_image, @event.image[:original].try { |image| image.url(public: true) } %>

<script type="application/ld+json">
{
 "@context": "http://schema.org",
 "@type": "BreadcrumbList",
 "itemListElement":
 [
  {
   "@type": "ListItem",
   "position": 1,
   "item":
   {
    "@id": "<%= city_events_url %>",
    "name": "Eventos em Porto Alegre"
    }
  },
  {
   "@type": "ListItem",
  "position": 2,
  "item":
   {
     "@id": "<%= category_events_url(@event.categories_primary_name) %>",
     "name": "<%= "Eventos em Porto Alegre na categoria #{@event.categories_primary_name.try(:capitalize)}" %>"
   }
  },
  {
    "@type": "ListItem",
    "position": 3,
    "item":
     {
       "@id": "<%= day_events_url(@event.day_of_week['date'].strftime('%d-%m-%Y')) %>",
       "name": "<%= "Eventos em Porto Alegre dia #{I18n.l(@event.day_of_week['date'], format: :long)}" %>"
     }
  },
  {
    "@type": "ListItem",
    "position": 4,
    "item":
     {
       "@id": "<%= place_path(@event.place) %>",
       "name": "<%= "Eventos em #{limit_place_name_size(@event.place_details_name, 30)}" %>"
     }
  }
 ]
}




</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Event",
  "name": "<%= @event.details_name.gsub(/[^[$][-]\p{L}\p{M}*+ ]/i, '') %>",
  "startDate": "<%= @event.ld_json.start_date %>",
  "endDate": "<%= @event.ld_json.end_date %>",
  "image": [
    "<%= @event.image[:original].try { |image| image.url(public: true) } %>"
   ],
  "description": "<%= strip_tags(@event.details_description).gsub(/[^[$][-]\p{L}\p{M}*+ ]/i, '') %>",
  "url": "<%= event_path(@event, format: :html) %>",
  "location": {
    "@type": "Place",
    "name": "<%= @event.place_details_name %>",
    "address": {
      "@type": "PostalAddress",
      "streetAddress": "<%= @event.geographic['address'] %>",
      "addressLocality": "<%= @event.geographic['city'] %>",
      "postalCode": "<%= @event.geographic['cep'] %>",
      "addressRegion": "RS",
      "addressCountry": {
        "@type": "Country",
        "name": "BR"
       }
    },
    "url": "<%= place_path @event.place %>"
  },
  "offers": {
    "@type": "AggregateOffer",
    "price": "<%= @event.ld_json.price %>",
    "lowPrice": "<%= @event.ld_json.low_price %>",
    "highPrice": "<%= @event.ld_json.high_price %>",
    "priceCurrency": "BRL",
    "url": "<%= event_path(@event, format: :html) %>",
    "availability": "<%= @event.ld_json.availability %>",
    "validFrom": "<%= @event.ld_json.valid_from %>"
  }
}

</script>

<%= render Modal::SignInComponent.new( text: nil) %>

<section id="page" class="max-w-screen-lg grid-cols-12 pb-10 md:grid md:gap-10 md:mt-10 md:mx-auto">
	<div class="md:col-span-8">
		<%= render(LargeEventComponent.new(event: @event, user: current_user)) %>
	</div>
	<div class="md:col-span-4 mb-10 md:mb-0 mt-5 md:mt-0">
		<div class="bg-gray-50 cursor-pointer flex font-bold hidden items-center bg-gray-50 md:block bottom-auto mb-5 relative rounded-xl w-auto p-3 space-y-2 text-gray-600 text-sm">
			<a href="<%= @event.details_source_url %>" target="_blank" class="transition-colors bg-white flex flex-1 group hover:bg-green-500 hover:text-white items-center justify-center py-3 rounded shadow-sm space-x-2 cursor-pointer">
				<div>Abrir no facebook</div>
				<svg class="group-hover:text-white transition-colors h-4 text-gray-400 fill-current" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
					<path d="M16 16H2V2H9V0H2C0.89 0 0 0.9 0 2V16C0 17.1 0.89 18 2 18H16C17.1 18 18 17.1 18 16V9H16V16ZM11 0V2H14.59L4.76 11.83L6.17 13.24L16 3.41V7H18V0H11Z"/>
				</svg>
			</a>
			<div class="transition-colors overflow-hidden relative bg-white flex flex-1 group hover:bg-green-500 hover:text-white items-center justify-center py-3 rounded shadow-sm space-x-2 cursor-pointer"
					 data-controller="share-button"
					 data-share-button-text="<%= strip_tags(limit_description_size(@event.details_description, 160)) %>"
					 data-share-button-title="<%= @event.details_name %>"
					 data-share-button-url="<%= event_url(@event, format: :html) %>"
					 data-action="click->share-button#share">
				<input class="absolute opacity-0" style="bottom: -30px" data-share-button-target="input" type="text" value="<%= event_url(@event, format: :html) %>">
				<div>Compartilhar</div>
				<svg class="group-hover:text-white transition-colors h-4 text-gray-400 fill-current" viewBox="0 0 18 20" fill="none" xmlns="http://www.w3.org/2000/svg">
					<path d="M15 14.08C14.24 14.08 13.56 14.38 13.04 14.85L5.91 10.7C5.96 10.47 6 10.24 6 10C6 9.76 5.96 9.53 5.91 9.3L12.96 5.19C13.5 5.69 14.21 6 15 6C16.66 6 18 4.66 18 3C18 1.34 16.66 0 15 0C13.34 0 12 1.34 12 3C12 3.24 12.04 3.47 12.09 3.7L5.04 7.81C4.5 7.31 3.79 7 3 7C1.34 7 0 8.34 0 10C0 11.66 1.34 13 3 13C3.79 13 4.5 12.69 5.04 12.19L12.16 16.35C12.11 16.56 12.08 16.78 12.08 17C12.08 18.61 13.39 19.92 15 19.92C16.61 19.92 17.92 18.61 17.92 17C17.92 15.39 16.61 14.08 15 14.08Z"/>
				</svg>
			</div>
		</div>

		<div class="overflow-hidden bg-white rounded-lg py-4 md:rounded-xl md:shadow-2xl md:border md:border-gray-100">
			<h2 class="px-5 font-extrabold uppercase">Similares</h2>
			<div class="md:space-y-2">
				<% if @similar_events.present? %>
					<% @similar_events.each do |similar_event| %>
						<div class="flex justify-between px-5 py-3 md:border-0">
							<div class="pr-6">
								<div class="mb-1 text-xs  text-gray-600">
									<%= I18n.l(similar_event.start_time, format: :long) %>
									às <%= format_hour similar_event.first_day_time %>h
									· <%= similar_event.categories_primary_name.titleize %>
								</div>
								<%= content_tag :a,
																href:  event_path(similar_event),
																data:  {
																	action:     'click->main-sidebar--horizontal-event#openEvent',
																	url:        event_path(similar_event),
																	'event-id': similar_event.id
																},
																class: 'md:hover:underline text-sm font-medium mb-1 leading-snug text-gray-600' do %>
									<%= similar_event.details_name %>
								<% end %>
							</div>
							<div>
								<div data-controller="ripple" class="relative w-24 mt-6 overflow-hidden rounded shadow-xs ripple ripple-white">
									<%= link_to event_path(similar_event),
															data: {
																action:     'click->main-sidebar--horizontal-event#openEvent',
																'event-id': similar_event.id
															} do %>
										<div class="bg-gray-50 aspect-ratio-16/9"></div>
										<%= image_tag shrine_image_url(similar_event, :feed), {
											loading: :lazy,
											class:   'absolute cursor-pointer h-full left-0 object-center object-cover top-0 w-full overflow-hidden',
											onerror: "this.style.opacity='0'"
										} rescue nil %>
									<% end %>
								</div>
							</div>
						</div>
					<% end %>
				<% else %>
					<div class="px-5 mt-4">
						Sem eventos similares
					</div>
				<% end %>
			</div>
		</div>
	</div>

	<div class="fixed bottom-0 flex items-center w-screen px-3 py-2 space-x-2 text-sm font-medium text-gray-500 cursor-pointer md:hidden bg-gray-50">
		<a href="<%= @event.details_source_url %>" target="_blank" class="flex items-center justify-center flex-1 py-3 space-x-2 bg-white rounded shadow-sm">
			<div>Abrir no facebook</div>
			<svg class="h-4 text-gray-400 fill-current" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
				<path d="M16 16H2V2H9V0H2C0.89 0 0 0.9 0 2V16C0 17.1 0.89 18 2 18H16C17.1 18 18 17.1 18 16V9H16V16ZM11 0V2H14.59L4.76 11.83L6.17 13.24L16 3.41V7H18V0H11Z"/>
			</svg>
		</a>
		<div class="flex items-center justify-center flex-1 py-3 space-x-2 bg-white rounded shadow-sm"
				 data-controller="share-button"
				 data-share-button-text="<%= strip_tags(limit_description_size(@event.details_description, 160)) %>"
				 data-share-button-title="<%= @event.details_name %>"
				 data-share-button-url="<%= event_url(@event, format: :html) %>"
				 data-action="click->share-button#share">
			<input class="absolute opacity-0" style="bottom: -30px" data-share-button-target="input" type="text" value="<%= event_url(@event, format: :html) %>">
			<div>Compartilhar</div>
			<svg class="h-4 text-gray-400 fill-current" viewBox="0 0 18 20" fill="none" xmlns="http://www.w3.org/2000/svg">
				<path d="M15 14.08C14.24 14.08 13.56 14.38 13.04 14.85L5.91 10.7C5.96 10.47 6 10.24 6 10C6 9.76 5.96 9.53 5.91 9.3L12.96 5.19C13.5 5.69 14.21 6 15 6C16.66 6 18 4.66 18 3C18 1.34 16.66 0 15 0C13.34 0 12 1.34 12 3C12 3.24 12.04 3.47 12.09 3.7L5.04 7.81C4.5 7.31 3.79 7 3 7C1.34 7 0 8.34 0 10C0 11.66 1.34 13 3 13C3.79 13 4.5 12.69 5.04 12.19L12.16 16.35C12.11 16.56 12.08 16.78 12.08 17C12.08 18.61 13.39 19.92 15 19.92C16.61 19.92 17.92 18.61 17.92 17C17.92 15.39 16.61 14.08 15 14.08Z"/>
			</svg>
		</div>
	</div>
</section>



