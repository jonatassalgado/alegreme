<%= notice %>

<% content_for :meta_title, "Evento #{@event.name} em Porto Alegre | Alegreme.com" %>
<% content_for :meta_description, strip_tags(limit_description_size(@event.description, 160)) %>
<% content_for :meta_image, @event.image[:original].try { |image| image.url(public: true) } %>
<% content_for :canonical_url, event_url(@event, format: :html) %>
<% content_for :amp_url, event_url(@event, format: :amp) %>

<% content_for :back_button, true %>
<% content_for :top_app_bar_title, truncate(@event.name, length: 30) %>

<%= content_for :preload_image, @event.image[:original].try { |image| image.url(public: true) } %>

<script type="application/ld+json">
{
 "@context": "http://schema.org",
 "@type": "BreadcrumbList",
 "itemListElement":
 [
  {
   "@type": "ListItem",
   "position": 1,
   "item":
   {
    "@id": "<%= city_events_url %>",
    "name": "Eventos em Porto Alegre"
    }
  },
  {
   "@type": "ListItem",
  "position": 2,
  "item":
   {
     "@id": "<%= category_events_url(@event.categories_primary_name) %>",
     "name": "<%= "Eventos em Porto Alegre na categoria #{@event.categories_primary_name.try(:capitalize)}" %>"
   }
  },
  {
    "@type": "ListItem",
    "position": 3,
    "item":
     {
       "@id": "<%= day_events_url(@event.start_time.strftime('%d-%m-%Y')) %>",
       "name": "<%= "Eventos em Porto Alegre dia #{I18n.l(@event.start_time, format: :day_month_year)}" %>"
     }
  },
  {
    "@type": "ListItem",
    "position": 4,
    "item":
     {
       "@id": "<%= place_path(@event.place) %>",
       "name": "<%= "Eventos em #{limit_place_name_size(@event.place_details_name, 30)}" %>"
     }
  }
 ]
}





</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Event",
  "name": "<%= @event.name.gsub(/[^[$][-]\p{L}\p{M}*+ ]/i, '') %>",
  "startDate": "<%= @event.ld_json.start_date %>",
  "endDate": "<%= @event.ld_json.end_date %>",
  "image": [
    "<%= @event.image[:original].try { |image| image.url(public: true) } %>"
   ],
  "description": "<%= strip_tags(@event.description).gsub(/[^[$][-]\p{L}\p{M}*+ ]/i, '') %>",
  "url": "<%= event_path(@event, format: :html) %>",
  "location": {
    "@type": "Place",
    "name": "<%= @event.place_details_name %>",
    "address": {
      "@type": "PostalAddress",
      "streetAddress": "<%= @event.geographic['address'] %>",
      "addressLocality": "<%= @event.geographic['city'] %>",
      "postalCode": "<%= @event.geographic['cep'] %>",
      "addressRegion": "RS",
      "addressCountry": {
        "@type": "Country",
        "name": "BR"
       }
    },
    "url": "<%= place_path @event.place %>"
  },
  "offers": {
    "@type": "AggregateOffer",
    "price": "<%= @event.ld_json.price %>",
    "lowPrice": "<%= @event.ld_json.low_price %>",
    "highPrice": "<%= @event.ld_json.high_price %>",
    "priceCurrency": "BRL",
    "url": "<%= event_path(@event, format: :html) %>",
    "availability": "<%= @event.ld_json.availability %>",
    "validFrom": "<%= @event.ld_json.valid_from %>"
  }
}




</script>

<%= render ModalComponent.new %>

<% if already_happened? @event %>
	<div class="flex items-center p-5 mx-4 mt-1 mb-3 space-x-2 max-w-screen-lg font-semibold rounded-lg border bg-brand-100 border-brand-200 md:mb-0 md:mt-5 md:mx-auto text-brand-600">
		<div class="flex flex-shrink-0 justify-center items-center mx-auto w-12 h-12 rounded-full bg-brand-100 sm:mx-0 sm:h-10 sm:w-10">
			<!-- Heroicon name: exclamation -->
			<svg class="w-6 h-6 text-brand-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
			</svg>
		</div>
		<div>
			Este evento já ocorreu <%= I18n.l(@event.end_time) if @event&.end_time %>.
		</div>
	</div>
<% end %>

<section id="page" class="grid-cols-8 pb-10 max-w-screen-lg md:grid md:gap-10 md:mt-10 md:mx-auto">
	<div class="md:col-span-5">
		<%= render(LargeEventComponent.new(event: @event, user: current_user)) %>
	</div>
	<div class="mt-5 md:col-span-3 md:mb-0 md:mt-28">
		<% if will_happen? @event %>
			<div class="flex hidden relative bottom-auto items-center p-3 space-y-2 w-auto text-sm text-gray-600 rounded-xl cursor-pointer md:block">
				<a href="<%= @event.source_url %>" target="_blank" rel="nofollow noreferrer" class="inline-block flex justify-start items-center py-2 px-4 mr-3 mb-3 text-gray-600 bg-gray-100 rounded-full transition-all transition-colors transform cursor-pointer select-none group duration-50 group-hover:bg-brand-200 hover:border-brand-200 hover:text-brand-600 tap-highlight-none w-content">
					<svg class="mr-3 h-5 text-gray-400 transition-colors stroke-current group-hover:text-brand-700" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
					</svg>
					<div>Abrir página oficial</div>
				</a>
				<% if @event&.ticket_url %>
					<a href="<%= @event.ticket_url %>" target="_blank" rel="nofollow noreferrer" class="inline-block flex justify-start items-center py-2 px-4 mr-3 mb-3 text-gray-600 bg-gray-100 rounded-full transition-all transition-colors transform cursor-pointer select-none group duration-50 group-hover:bg-brand-200 hover:border-brand-200 hover:text-brand-600 tap-highlight-none w-content">
						<svg class="mr-3 h-5 text-gray-400 transition-colors fill-current group-hover:text-brand-700" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M0 0h24v24H0V0z" fill="none"/>
							<path d="M22 10V6c0-1.1-.9-2-2-2H4c-1.1 0-1.99.9-1.99 2v4c1.1 0 1.99.9 1.99 2s-.89 2-2 2v4c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-4c-1.1 0-2-.9-2-2s.9-2 2-2zm-2-1.46c-1.19.69-2 1.99-2 3.46s.81 2.77 2 3.46V18H4v-2.54c1.19-.69 2-1.99 2-3.46 0-1.48-.8-2.77-1.99-3.46L4 6h16v2.54zM9.07 16L12 14.12 14.93 16l-.89-3.36 2.69-2.2-3.47-.21L12 7l-1.27 3.22-3.47.21 2.69 2.2z"/>
						</svg>
						<div>Comprar ingressos</div>
					</a>
				<% end %>
				<div class="inline-block flex justify-start items-center py-2 px-4 mr-3 mb-3 text-gray-600 bg-gray-100 rounded-full transition-all transition-colors transform cursor-pointer select-none group duration-50 group-hover:bg-brand-200 hover:border-brand-200 hover:text-brand-600 tap-highlight-none w-content"
						 data-controller="share-button"
						 data-share-button-text="<%= strip_tags(limit_description_size(@event.description, 160)) %>"
						 data-share-button-title="<%= @event.name %>"
						 data-share-button-url="<%= event_url(@event, format: :html) %>"
						 data-action="click->share-button#share">
					<input class="absolute opacity-0" style="bottom: -30px" data-share-button-target="input" type="text" value="<%= event_url(@event, format: :html) %>">
					<svg class="mr-3 h-4 text-gray-400 transition-colors fill-current group-hover:text-brand-700" viewBox="0 0 18 20" fill="none" xmlns="http://www.w3.org/2000/svg">
						<path d="M15 14.08C14.24 14.08 13.56 14.38 13.04 14.85L5.91 10.7C5.96 10.47 6 10.24 6 10C6 9.76 5.96 9.53 5.91 9.3L12.96 5.19C13.5 5.69 14.21 6 15 6C16.66 6 18 4.66 18 3C18 1.34 16.66 0 15 0C13.34 0 12 1.34 12 3C12 3.24 12.04 3.47 12.09 3.7L5.04 7.81C4.5 7.31 3.79 7 3 7C1.34 7 0 8.34 0 10C0 11.66 1.34 13 3 13C3.79 13 4.5 12.69 5.04 12.19L12.16 16.35C12.11 16.56 12.08 16.78 12.08 17C12.08 18.61 13.39 19.92 15 19.92C16.61 19.92 17.92 18.61 17.92 17C17.92 15.39 16.61 14.08 15 14.08Z"/>
					</svg>
					<div>Compartilhar</div>
				</div>
			</div>
		<% end %>

		<div class="border-t border-gray-100 md:border-0 inline-block p-5 py-8 space-y-3">
			<h2 class="c-h3">Organizadores</h2>
			<% @event.organizers.each do |organizer| %>
				<%= link_to organizer_path(organizer), class: 'flex items-center space-x-3' do %>
					<%= image_tag organizer.image[:sm].try { |image| image.url(public: true) },
												loading: :lazy,
												alt:     organizer.details_name,
												class:   'border w-8 h-8 rounded-full shadow-sm',
												onerror: "this.style.opacity='0'" rescue nil %>
					<div>
						<%= organizer.details_name %>
						·
						<%= render(FollowButtonComponent.new(
							user:       current_user,
							followable: organizer,
							type:       'text'
						)) %>
					</div>
				<% end %>
			<% end %>
		</div>

		<div class="border-t border-b border-gray-100 md:border-0 py-8 space-y-3">
			<h2 class="px-5 c-h3">Similares</h2>
			<div class="md:space-y-2">
				<% if @similar_events.present? %>
					<% @similar_events.each do |similar_event| %>
						<div class="flex justify-start py-3 px-5 md:border-0">
							<div>
								<div class="overflow-hidden relative w-16 h-16 rounded">
									<%= link_to event_path(similar_event),
															'aria-label': "Ver evento #{similar_event&.name}",
															data:         {
																action:     'click->main-sidebar--horizontal-event#openEvent',
																'event-id': similar_event.id
															} do %>
										<%= image_tag shrine_image_url(similar_event, :feed), {
											loading: :lazy,
											alt:     similar_event.name,
											class:   'bg-gray-100 cursor-pointer h-full object-center object-cover w-full overflow-hidden',
											onerror: "this.style.opacity='0'"
										} rescue nil %>
									<% end %>
								</div>
							</div>
							<div class="pl-6">
								<%= content_tag :a,
																href:  event_path(similar_event),
																data:  {
																	action:     'click->main-sidebar--horizontal-event#openEvent',
																	url:        event_path(similar_event),
																	'event-id': similar_event.id
																},
																class: 'md:hover:underline inline-block md:text-sm mb-1 leading-snug text-gray-700' do %>
									<%= similar_event.name %>
								<% end %>
							</div>
						</div>
					<% end %>
				<% else %>
					<div class="px-5 mt-4">
						Sem eventos similares
					</div>
				<% end %>
			</div>
		</div>

		<%= link_to category_events_path(@event&.categories_url), class: 'flex p-5 text-gray-800 mt-5 bg-white cursor-pointer inline-block md:hover:bg-brand-100 md:hover:text-brand-600 overflow-hidden rounded-lg space-y-3' do %>
			<div class="pr-10">
				<h2 class="text-xl font-bold rounded-lg font-display">
					<%= @event&.categories_display_name %>
				</h2>
				<div class="">
					Ver todos os eventos da categoria <%= @event&.categories_display_name&.underscore %> em Porto Alegre
				</div>
			</div>
			<svg xmlns="http://www.w3.org/2000/svg" class="w-6 stroke-current flex-shrink-0" fill="none" viewBox="0 0 24 24">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
			</svg>
		<% end %>
	</div>

	<div class="flex fixed bottom-0 py-3 px-3 space-x-2 w-screen text-sm font-medium text-gray-500 bg-white border-t cursor-pointer select-none md:hidden tap-highlight-none">
		<a href="<%= @event.source_url %>" target="_blank" rel="nofollow noreferrer" class="flex-1 justify-center space-x-2 select-none c-chip">
			<div>Site oficial</div>
			<svg class="h-5 stroke-current" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
			</svg>
		</a>
		<div class="flex-1 justify-center space-x-2 select-none c-chip"
				 data-controller="share-button"
				 data-share-button-text="<%= strip_tags(limit_description_size(@event.description, 160)) %>"
				 data-share-button-title="<%= @event.name %>"
				 data-share-button-url="<%= event_url(@event, format: :html) %>"
				 data-action="click->share-button#share">
			<input class="absolute opacity-0" style="bottom: -30px" data-share-button-target="input" type="text" value="<%= event_url(@event, format: :html) %>">
			<div>Compartilhar</div>
			<svg class="h-4 fill-current" viewBox="0 0 18 20" fill="none" xmlns="http://www.w3.org/2000/svg">
				<path d="M15 14.08C14.24 14.08 13.56 14.38 13.04 14.85L5.91 10.7C5.96 10.47 6 10.24 6 10C6 9.76 5.96 9.53 5.91 9.3L12.96 5.19C13.5 5.69 14.21 6 15 6C16.66 6 18 4.66 18 3C18 1.34 16.66 0 15 0C13.34 0 12 1.34 12 3C12 3.24 12.04 3.47 12.09 3.7L5.04 7.81C4.5 7.31 3.79 7 3 7C1.34 7 0 8.34 0 10C0 11.66 1.34 13 3 13C3.79 13 4.5 12.69 5.04 12.19L12.16 16.35C12.11 16.56 12.08 16.78 12.08 17C12.08 18.61 13.39 19.92 15 19.92C16.61 19.92 17.92 18.61 17.92 17C17.92 15.39 16.61 14.08 15 14.08Z"/>
			</svg>
		</div>
	</div>

	<!--	<div data-controller="install" data-install-native="true" data-install-target="button" class="flex fixed bottom-20 z-30 items-center w-full transition-transform transform translate-y-32 select-none tap-highlight-none">-->
	<!--		<span data-action="click->install#install" class="py-3 px-5 mx-auto font-bold text-white bg-white rounded-full shadow-lg bg-brand-500 w-content">-->
	<!--			Instalar aplicativo-->
	<!--		</span>-->
	<!--	</div>-->

</section>



