<%= notice %>

<% content_for :meta_title, "#{@event.details_name} | Alegreme.com" %>
<% content_for :meta_description, strip_tags(limit_description_size(@event.details_description, 160)) %>
<% content_for :meta_image, @event.image[:original].url %>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Event",
  "name": "<%= @event.details_name %>",
  "startDate": "<%= @event.first_day_time.to_datetime.iso8601 %>",
  "endDate": "",
  "url": "<%= event_path @event %>",
  "location": {
    "@type": "Place",
    "name": "<%= @event.place_details_name %>",
    "address": {
      "@type": "PostalAddress",
      "streetAddress": "<%= @event.geographic['address'] %>",
      "addressLocality": "<%= @event.geographic['city'] %>",
      "postalCode": "<%= @event.geographic['cep'] %>",
      "addressRegion": "RS",
      "addressCountry": "BR"
    },
    "url": "<%= place_path @event.place %>"
  },
  "image": [
    "<%= full_image_url @event.image[:original].url %>"
   ],
  "description": "<%= strip_tags @event.details_description %>"
}
</script>

<div id="event" class="me-card me-card--single event-<%= @event.id %>"
     data-controller="event"
     data-target="event.event"
     data-event-favorited="<%= current_user and current_user.taste_events_saved?(@event.id) if current_user and current_user %>"
     data-event-identifier="<%= @event.id %>"
     data-event-description-open="false"
     data-event-modifier="single">

  <div class="me-card__head">
    <div class="me-card__media" style="<%= get_image_style_attr @event %>; background-image: url('<%= @event.image[:feed].url(public: true) %>')">
      <% if current_user %>
        <div class="me-card__like-button" data-action="click->event#like">
          <div data-target="event.like">
            <button data-target="event.likeButton" id="add-to-favorites"
                    class="me-icon-button mdc-icon-button <%= 'mdc-icon-button--on' if current_user.taste_events_saved?(@event.id) %>"
                    aria-label="Add to favorites" aria-hidden="true" aria-pressed="false">
              <i class="material-icons mdc-icon-button__icon mdc-icon-button__icon--on">star</i>
              <i class="material-icons-sharp mdc-icon-button__icon">star_border</i>
            </button>
          </div>
        </div>
      <% end %>
    </div>
    <h2 class="me-card__name">
      <%= @event.details_name %>
    </h2>
  </div>

  <div class="me-card__content">
    <div class="me-card__primary-section">
      <div class="me-card__place">
        <% if @event.place %>
          <i class="material-icons">
            place
          </i>
          <div>
            <h3>
              <%= link_to limit_place_name_size(@event.place_details_name, 30), place_path(@event.place) %>
            </h3>
            <span>
            <%= limit_address_name_size @event.geographic['address'] %>
          </span>
          </div>
        <% end %>
      </div>
      <div class="me-card__date">
        <% if @event.place %>
          <i class="material-icons">
            today
          </i>
          <div>
            <h3>
              <%= "#{@event.day_of_week['decorator']} #{format_hour @event.first_day_time }" %>
            </h3>
            <span>
              <%= I18n.l(@event.day_of_week['date'], format: :long) %>
          </span>
          </div>
        <% end %>
      </div>
    </div>

    <div class="me-card__topics">
      <%#= render partial: 'components/follow/follow-chip-set', locals: { user: current_user, chips: @event.categories.sort, event_id: @event.id, type: 'categories' } %>
      <%= render partial: 'components/follow/follow', locals: {user: current_user, chips: @event.organizers.sort, event_id: @event.id, type: 'organizers'} %>
    </div>


    <div class="me-card__description">
      <div class="me-card__description-wrapper">
        <%= @event.details_description.html_safe %>
      </div>
      <button data-action="click->event#readMore" class="mdc-button">
        <span class="mdc-button__label">MOSTRAR MAIS</span>
      </button>
    </div>
  </div>
</div>

<% if current_user&.admin? %>
  <a href="<%= @event.url %>/edit">Editar</a>
  <a href="/train">Treinar</a>
<% end %>

<!--<ul>-->
<%# @event.similar_data.each do |similar| %>
<!--    <li><%#= "#{Event.find(similar).id} #{Event.find(similar).details_name}" %></li>-->
<%# end %>
<!--</ul>-->
