<section class="me-page me-page--events-section is-animated">

  <%= notice %>

  <% content_for :meta_title, "Evento #{@event.details_name.gsub(/[^[0-9][$][-]\p{L}\p{M}*+ ]|[+]/i, '')} em Porto Alegre | Alegreme.com" %>
  <% content_for :meta_description, strip_tags(limit_description_size(@event.details_description, 160)) %>
  <% content_for :meta_image, @event.image[:original].url %>
  <% content_for :canonical_url, event_url(@event, format: :html) %>
  <% content_for :amp_url, event_url(@event, format: :amp) %>

  <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Event",
  "name": "<%= @event.details_name.gsub(/[^[0-9][$][-]\p{L}\p{M}*+ ]/i, '') %>",
  "startDate": "<%= @event.ld_json.start_date %>",
  "endDate": "<%= @event.ld_json.end_date %>",
  "image": [
    "<%= @event.image[:original].url %>"
   ],
  "description": "<%= strip_tags(@event.details_description).gsub(/[^[0-9][$][-]\p{L}\p{M}*+ ]/i, '') %>",
  "url": "<%= event_path @event %>",
  "location": {
    "@type": "Place",
    "name": "<%= @event.place_details_name %>",
    "address": {
      "@type": "PostalAddress",
      "streetAddress": "<%= @event.geographic['address'] %>",
      "addressLocality": "<%= @event.geographic['city'] %>",
      "postalCode": "<%= @event.geographic['cep'] %>",
      "addressRegion": "RS",
      "addressCountry": {
        "@type": "Country",
        "name": "BR"
       }
    },
    "url": "<%= place_path @event.place %>"
  },
  "offers": {
    "@type": "AggregateOffer",
    "price": "<%= @event.ld_json.price %>",
    "lowPrice": "<%= @event.ld_json.low_price %>",
    "highPrice": "<%= @event.ld_json.high_price %>",
    "priceCurrency": "BRL",
    "url": "<%= event_path @event %>",
    "availability": "<%= @event.ld_json.availability %>",
    "validFrom": "<%= @event.ld_json.valid_from %>"
  }
}


  </script>

  <div id="event" class="me-card me-card--single event-<%= @event.id %>"
       data-controller="event"
       data-target="event.event"
       data-event-favorited="<%= current_user and current_user.taste_events_saved?(@event.id) if current_user and current_user %>"
       data-event-identifier="<%= @event.id %>"
       data-event-description-open="false"
       data-event-modifier="single">

    <div class="me-card__head">
      <div class="me-card__media" style="<%= get_image_style_attr @event %>; background-image: url('<%= @event.image[:original].url(public: true) %>')">
        <% if current_user %>
          <div class="me-card__like-button" data-action="click->event#like">
            <div data-target="event.like">
              <button data-target="event.likeButton" id="add-to-favorites"
                      class="me-icon-button mdc-icon-button <%= 'mdc-icon-button--on' if current_user.taste_events_saved?(@event.id) %>"
                      aria-label="Add to favorites" aria-hidden="true" aria-pressed="false">
                <i class="material-icons mdc-icon-button__icon mdc-icon-button__icon--on">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 62 62">
                    <defs/>
                    <path fill-rule="evenodd" d="M61.9999 31c0 17.1208-13.8791 30.9999-30.9999 30.9999C13.8792 61.9999 0 48.1208 0 31 0 13.8792 13.8792 0 31 0s30.9999 13.8792 30.9999 31zm-13.6836-7.8711c0 2.9426-2.3932 5.3281-5.3454 5.3281-2.9522 0-5.3454-2.3855-5.3454-5.3281s2.3932-5.3281 5.3454-5.3281c2.9522 0 5.3454 2.3855 5.3454 5.3281zm-23.8208 0c0 2.9426-2.3933 5.3281-5.3455 5.3281-2.9522 0-5.3454-2.3855-5.3454-5.3281s2.3932-5.3281 5.3454-5.3281c2.9522 0 5.3455 2.3855 5.3455 5.3281zm23.0007 16.3239c.0243-.0454 1.6832-3.2152 1.699-3.2458L13.5 36.2266l1.396 3.0497.0034.0067.0079.0156.0205.0401c.0158.0305.0359.0687.0602.1141.0488.0907.1149.2103.1988.3546.1676.2882.4077.6775.7238 1.134.6292.9088 1.5775 2.1099 2.878 3.3139 2.6185 2.4243 6.7324 4.9088 12.4535 4.9088s9.835-2.4845 12.4535-4.9088c1.3005-1.204 2.2488-2.4051 2.878-3.3139.3161-.4565.5562-.8458.7238-1.134.0839-.1443.15-.2639.1988-.3546z" clip-rule="evenodd"/>
                  </svg>
                </i>
                <i class="material-icons-sharp mdc-icon-button__icon">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 62 62">
                    <defs/>
                    <path fill-rule="evenodd" d="M61.9999 31c0 17.1208-13.8791 30.9999-30.9999 30.9999C13.8792 61.9999 0 48.1208 0 31 0 13.8792 13.8792 0 31 0s30.9999 13.8792 30.9999 31zm-13.6836-7.8711c0 2.9426-2.3932 5.3281-5.3454 5.3281-2.9522 0-5.3454-2.3855-5.3454-5.3281s2.3932-5.3281 5.3454-5.3281c2.9522 0 5.3454 2.3855 5.3454 5.3281zm-23.8208 0c0 2.9426-2.3933 5.3281-5.3455 5.3281-2.9522 0-5.3454-2.3855-5.3454-5.3281s2.3932-5.3281 5.3454-5.3281c2.9522 0 5.3455 2.3855 5.3455 5.3281zm-6.5704 14.621c-3.032 1.5205-3.0313 1.5219-3.0306 1.5234l.0015.003.0034.0067.0079.0156.0205.0401c.0158.0305.0359.0687.0602.1141.0488.0907.1149.2103.1988.3546.1676.2882.4077.6775.7238 1.134.6292.9088 1.5775 2.1099 2.878 3.3139 2.6185 2.4243 6.7324 4.9088 12.4535 4.9088s9.835-2.4845 12.4535-4.9088c1.3005-1.204 2.2488-2.4051 2.878-3.3139.3161-.4565.5562-.8458.7238-1.134.0839-.1443.15-.2639.1988-.3546a8.407 8.407 0 00.0602-.1141l.0206-.0401.0078-.0156.0034-.0067.0015-.003c.0007-.0015.0015-.0029-3.0306-1.5234-3.032-1.5206-3.0313-1.5219-3.0306-1.5233l.0012-.0025.0023-.0045.0035-.0069.0028-.0056a5.1948 5.1948 0 01-.0971.1739c-.0873.1501-.2322.3869-.4363.6817-.4112.5939-1.0443 1.3964-1.9079 2.1959-1.7095 1.5827-4.2541 3.1054-7.8549 3.1054-3.6008 0-6.1454-1.5227-7.8549-3.1054-.8636-.7995-1.4967-1.602-1.9079-2.1959a10.3959 10.3959 0 01-.4362-.6817 5.039 5.039 0 01-.0867-.1541c-.0072-.0133-.0107-.0201-.0106-.0199l.0029.0057.0035.0069.0023.0045.0012.0025c.0007.0014.0014.0027-3.0306 1.5233z" clip-rule="evenodd"/>
                  </svg>
                </i>
              </button>
            </div>
          </div>
        <% end %>
      </div>
      <h1 class="me-card__name">
        <%= @event.details_name %>
      </h1>
    </div>

    <div class="me-card__content">
      <div class="me-card__primary-section">
        <div class="me-card__place">
          <% if @event.place %>
            <i class="material-icons">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                <path fill="none" d="M0 0h24v24H0V0z"/>
                <path d="M12 2C8.13 2 5 5.13 5 9c0 4.17 4.42 9.92 6.24 12.11.4.48 1.13.48 1.53 0C14.58 18.92 19 13.17 19 9c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
              </svg>
            </i>
            <div>
              <div class="me-card__date-title">
                <%= link_to limit_place_name_size(@event.place_details_name, 30), place_path(@event.place), class: 'me-is-clickable' %>
              </div>
              <%= link_to google_maps_url(@event.geographic['address']), class: 'me-card__address', target: '_blank' do %>
                <%= limit_address_name_size @event.geographic['address'] %>
              <% end %>
            </div>
          <% end %>
        </div>
        <div class="me-card__date">
          <% if @event.place %>
            <i class="material-icons">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                <path d="M0 0h24v24H0z" fill="none"/>
                <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
              </svg>
            </i>
            <div>
              <div class="me-card__place-title">
                <%= "#{@event.day_of_week['decorator']} #{format_hour @event.first_day_time }" %>
              </div>
              <span>
              <%= I18n.l(@event.day_of_week['date'], format: :long) %>
          </span>
            </div>
          <% end %>
        </div>
      </div>

      <div class="me-card__topics">
        <%#= render partial: 'components/follow/follow-chip-set', locals: { user: current_user, chips: @event.categories.sort, event_id: @event.id, type: 'categories' } %>
        <%= render partial: 'components/follow/follow', locals: {user: current_user, chips: @event.organizers.sort, event_id: @event.id, type: 'organizers'} %>
      </div>


      <div class="me-card__description">
        <div class="me-card__description-wrapper">
          <%= @event.details_description.html_safe %>
        </div>
        <button data-action="click->event#readMore" class="mdc-button">
          <span class="mdc-button__label">MOSTRAR MAIS</span>
        </button>
      </div>
    </div>
  </div>

  <% if current_user&.admin? %>
    <a href="<%= @event.url %>/edit">Editar</a>
    <a href="/train">Treinar</a>
  <% end %>



  <section class="me-event-single__similar">
    <h2 class="me-h2 me-h2--centralize">Eventos similares</h2>
    <div class="mdc-layout-grid">
      <div class="mdc-layout-grid__inner">
        <%= render partial:    'components/collection/event',
                   collection: @similar_events,
                   as:         :event,
                   locals:     {
                       identifier:      @event.slug,
                       json_request:    false,
                       display_similar: false
                   },
                   cached:     true %>
      </div>
    </div>
  </section>

  <% unless current_user %>
    <%= link_to root_path, style: "display: flex" do %>
      <img class="me-banner" data-gtm="banner-request-invite-footer" loading="lazy" src="<%= image_url 'banners/get-invite-banner' %>" alt="Pegue um convite">
    <% end %>
  <% end %>
</section>