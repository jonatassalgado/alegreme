<%= component_controller id: "feed-tabs", class: "md:mt-2 md:mx-10" do %>
  <div id="feed-menu" class="w-full px-5 md:px-1 pt-4 scrollx"
       data-controller="scroll-on-clicked"
       data-scroll-on-clicked-init-selected="<%= @selected_tab %>"
       data-scroll-on-clicked-offset-left="24"
       data-scroll-on-clicked-target="scroller">
    <div class="flex pr-32 md:pr-0 space-x-3 w-content">
      <%= reflex_tag :select, :div, data: {tab: 'suggestions'}, class: (helpers.class_names 'px-4 py-1 rounded-full h-content cursor-pointer',
                                                                                            {'bg-white md:bg-gray-100':                              @selected_tab != 'suggestions',
                                                                                             'bg-green-50 text-green-600 border-2 border-green-300': @selected_tab == 'suggestions'}) do %>
        <div class="<%= helpers.class_names 'font-semibold text-base',
                                            {'text-gray-700':  @selected_tab != 'suggestions',
                                             'text-green-600': @selected_tab == 'suggestions'} %>">
          Indicados para você
        </div>
        <div class="<%= helpers.class_names 'text-sm -mt-1',
                                            {'text-gray-600':  @selected_tab != 'suggestions',
                                             'text-green-600': @selected_tab == 'suggestions'} %>">
          Com base no que você gostou
        </div>
      <% end %>
      <%= reflex_tag :select, :div, data: {tab: 'places'}, class: (helpers.class_names 'px-4 py-1 rounded-full h-content cursor-pointer',
                                                                                       {'bg-white md:bg-gray-100':                              @selected_tab != 'places',
                                                                                        'bg-green-50 text-green-600 border-2 border-green-300': @selected_tab == 'places'}) do %>
        <div class="<%= helpers.class_names 'font-semibold text-base',
                                            {'text-gray-700':  @selected_tab != 'places',
                                             'text-green-600': @selected_tab == 'places'} %>">
          Locais e organizadores
        </div>
        <div class="<%= helpers.class_names 'text-sm -mt-1',
                                            {'text-gray-600':  @selected_tab != 'places',
                                             'text-green-600': @selected_tab == 'places'} %>">
          Que você segue
        </div>
      <% end %>
    </div>
  </div>
  <% if @selected_tab == 'suggestions' %>
    <div id="suggested-events" class="grid w-full grid-flow-col gap-5 px-5 md:px-0 pt-3 pb-5 grid-after-margin scrollx">
      <%= render Hero::CardEventComponent.with_collection(@suggested_events, user: @user) %>
    </div>
  <% elsif @selected_tab == 'places' %>
    <% if @user.following_places_and_organizers.present? %>
      <div id="place-events" class="grid w-full grid-flow-col gap-3 px-5 md:px-0 pt-3 pb-5 grid-after-margin scrollx">
        <% @user.following_places_and_organizers.filter { |f| f.events.active.present? }.each do |entity| %>
          <div class="bg-white flex flex-col group h-content p-3 relative rounded-lg shadow tap-highlight-none w-56">
            <a class="leading-tight font-medium text-gray-500" href="<%= helpers.organizer_or_place_path entity %>">
              <%= entity.details_name %>
            </a>
            <div class="grid grid-cols-2 gap-2 mt-3">
              <% entity.events.active.not_ml_data.limit(4).each do |event| %>
                <div data-controller="ripple" class="h-content overflow-hidden relative ripple ripple-white rounded w-full">
                  <div class="bg-gray-50 aspect-ratio-16/9"></div>
                  <%= link_to event_path(event) do %>
                    <%= image_tag helpers.shrine_image_url(event, :feed), {
                        loading: :lazy,
                        class:   'absolute cursor-pointer left-0 object-center object-cover top-0 w-full overflow-hidden',
                        onerror: "this.style.opacity='0'"
                    } %>
                  <% end %>
                </div>
              <% end %>
            </div>
            <% if entity.events.active.not_ml_data.size > 4 %>
              <%= link_to "Ver todos os #{entity.events.active.not_ml_data.size} eventos", helpers.organizer_or_place_path(entity), class: '-mb-3 -mx-3 mt-2 py-2 rounded-b-lg text-center text-green-500 text-sm' %>
            <% else %>
              <%= link_to "Ver eventos", helpers.organizer_or_place_path(entity), class: '-mb-3 -mx-3 mt-2 py-2 rounded-b-lg text-center text-green-500 text-sm' %>
            <% end %>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="leading-tight mt-4 px-5 md:px-0 text-gray-800 text-sm">
        Você ainda não segue locais e organizadores. Abaixo algumas sugestões:
      </div>
      <div id="place-events" class="grid w-full grid-flow-col gap-3 px-5 pt-3 pb-5 grid-after-margin scrollx">
        <% @user.resources_from_liked_events[0..6].each do |resource| %>
          <div class="bg-white group h-content p-3 relative rounded-lg shadow tap-highlight-none w-56">
            <a class="leading-tight font-medium text-gray-600" href="<%= helpers.organizer_or_place_path resource %>">
              <%= resource.details_name %>
            </a>
            <div class="grid grid-cols-2 gap-2 mt-3">
              <% resource.events.active.not_ml_data.limit(4).each do |event| %>
                <div data-controller="ripple" class="h-content overflow-hidden relative ripple ripple-white rounded w-full">
                  <div class="bg-gray-50 aspect-ratio-16/9"></div>
                  <%= link_to event_path(event) do %>
                    <%= image_tag helpers.shrine_image_url(event, :feed), {
                        loading: :lazy,
                        class:   'absolute cursor-pointer left-0 object-center object-cover top-0 w-full overflow-hidden',
                        onerror: "this.style.opacity='0'"
                    } %>
                  <% end %>
                </div>
              <% end %>
            </div>
            <div class="mt-3">
              <%= render partial: 'components/follow/follow_button', locals: {
                  user:       @user,
                  followable: resource
              } %>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>
  <% end %>
<% end %>