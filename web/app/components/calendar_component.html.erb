<%= content_tag :div, id: 'calendar', data: { controller: 'calendar' }, class: 'h-full' do %>
	<div class="h-full">
		<div data-calendar-target="calendar" class="calendar bg-white mb-5 mb:bg-transparent md:mb-2 md:mx-0 md:py-3 md:rounded-lg md:shadow-none md:text-center py-2 rounded-lg select-none tap-highlight-none text-center">
			<div class="capitalize flex font-medium items-center justify-between pb-5 rounded-t-lg text-gray-500">
				<div class="flex items-center">
				<span class="font-display ml-4 mr-2 text-2xl text-brand-500">
					<%= t('date.month_names')[start_date.month] %> <%= start_date.year %>
				</span>
					<svg data-calendar-target="loadingIcon" class="opacity-0 text-brand-600 w-7 h-7 ml-2 fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
						<path fill="none" d="M0 0h24v24H0V0z"/>
						<path d="M17.65 6.35c-1.63-1.63-3.94-2.57-6.48-2.31-3.67.37-6.69 3.35-7.1 7.02C3.52 15.91 7.27 20 12 20c3.19 0 5.93-1.87 7.21-4.56.32-.67-.16-1.44-.9-1.44-.37 0-.72.2-.88.53-1.13 2.43-3.84 3.97-6.8 3.31-2.22-.49-4.01-2.3-4.48-4.52C5.31 9.44 8.26 6 12 6c1.66 0 3.14.69 4.22 1.78l-1.51 1.51c-.63.63-.19 1.71.7 1.71H19c.55 0 1-.45 1-1V6.41c0-.89-1.08-1.34-1.71-.71l-.64.65z"/>
					</svg>
				</div>
				<div class="flex text-gray-800 pt-2 pr-2">
					<%= content_tag :button, id: 'calendar-previous', data: { reflex: 'click->Calendar#prev_month', start_date: start_date }, class: 'cursor-pointer flex focus:bg-brand-500 focus:outline-none focus:text-white h-8 items-center justify-center md:hover:bg-brand-500 md:hover:text-white mx-1 rounded-full w-8' do %>
						<svg class="h-6 fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
							<path d="M0 0h24v24H0z" fill="none"/>
							<path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
						</svg>
					<% end %>

					<%= content_tag :button, id: 'calendar-next', data: { reflex: 'click->Calendar#next_month', start_date: start_date }, class: 'cursor-pointer flex focus:bg-brand-500 focus:outline-none focus:text-white h-8 items-center justify-center md:hover:bg-brand-500 md:hover:text-white mx-1 rounded-full w-8' do %>
						<svg class="h-6 fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
							<path d="M0 0h24v24H0z" fill="none"/>
							<path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
						</svg>
					<% end %>
				</div>
			</div>

			<table data-calendar-target="table" class="table-auto w-full">
				<thead>
				<tr>
					<% date_range.slice(0, 7).each do |day| %>
						<th class="pb-2 text-gray-600 uppercase text-xs font-medium"><%= t('date.abbr_day_names')[day.wday] %></th>
					<% end %>
				</tr>
				</thead>

				<tbody>
				<% date_range.each_slice(7) do |week| %>
					<tr>
						<% week.each do |day| %>
							<%= content_tag :td, id: "calendar-#{day.strftime}", data: { action: 'click->calendar#inDay', day: day.strftime }, class: td_classes_for(day) do %>
								<%= content_tag :div, class: helpers.class_names('relative z-10 mx-auto text-xs day-of-month',
																																 { 'mt-1':                                               @indicators&.include?(day),
																																	 'today flex items-center justify-center flex-col':    Date.current == day,
																																	 'selected flex items-center justify-center flex-col': day.to_date == start_date.to_date && @filter }) do %>
									<div class="z-20">
										<%= day.strftime '%e' %>
									</div>
								<% end %>
								<% if @indicators&.include?(day) %>
									<div data-indicator class="<%= helpers.class_names 'h-1 mx-auto rounded-full transform translate-y-2 w-1 bg-brand-500' %>">
								<% end %>
								</div>
							<% end %>
						<% end %>
					</tr>
				<% end %>
				</tbody>
			</table>
		</div>


		<div id="calendar__list" data-calendar-target="list">
			<div class="<%= helpers.class_names('mb-1 bg-brand-500 flex font-semibold items-center mt-3 mx-auto px-3 py-2 rounded-full select-none text-sm text-white w-content',
																					'hidden': !@filter) %>">
				<svg class="h-5 mr-2 text-white fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
					<path d="M0 0h24v24H0z" fill="none"/>
					<path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/>
				</svg>
				<%= start_date.strftime("%d/%m/%Y") %>
			</div>
			<%= content_tag :div,
											data:  {
												reflex: 'click->Calendar#clear_filter'
											},
											id:    'calendar__clear-filter',
											class: helpers.class_names('px-5 text-center cursor-pointer underline text-gray-500 text-xs mb-5',
																								 'hidden': !@filter) do %>
				Remover filtro
			<% end %>
			<% if @events.present? %>
				<div id="calendar__events" class="pb-20">
					<%= render Calendar::HorizontalEventComponent.with_collection(@events, user: @user) %>
				</div>
			<% end %>
		</div>

		<% if @user && @events.empty? && (@start_date != Date.today) %>
			<div id="calendar__filter" class="text-sm text-center text-gray-600">
				Sem eventos na sua agenda neste dia.
				<%= content_tag :div, data: { reflex: 'click->Calendar#clear_filter' }, class: 'text-center cursor-pointer underline text-gray-500 text-sm' do %>
					Remover filtro
				<% end %>
			</div>
		<% elsif @user && @events.empty? %>
			<div id="calendar__filter" class="p-2 my-6 mt-3 text-sm text-center text-gray-600 rounded-lg bg-gray-50">
				Você não tem eventos salvos na sua agenda
			</div>
		<% elsif !@user %>
			<div class="text-sm text-center text-gray-600">
				<%= link_to 'Crie uma conta', new_user_registration_path, data: { 'gtm-action': 'click', 'gtm-category': 'Funil', 'gtm-label': 'Criar meu perfil' }, class: 'underline text-brand-500 hover:text-gray-600' %>
				para salvar seus eventos favoritos
			</div>
		<% end %></div>

<% end %>